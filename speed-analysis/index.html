<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E7 Speed Analysis v0.06</title>
    <style>
        img {
            max-width: 400px;
            max-height: 400px;
            width: 400px;
            height: 400px;
            display: block;
        }

        #findButton {
            width: 100px;
            height: 100px;
            font-size: 16px;
        }

        #result {
            margin-top: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>

<h1>E7 Speed Analysis</h1>

<br>
<img id="displayedImage" src="default_image.jpg" alt="Selected Image">
<br>
Load Image From File:  <input type="file" accept="image/*" id="imageInput" onchange="loadImage()">
<br>
<br>

<br>
<button id="findButton" onclick="findCharacters()">Find Characters</button>

<div id="result"></div>
<img id="resultImage" alt="Result Image">

<script>
    let imageInput = document.getElementById('imageInput');
    let displayedImage = document.getElementById('displayedImage');
    let resultDiv = document.getElementById('result');
    let resultImage = document.getElementById('resultImage');

    // Display default image on page load
    window.onload = function () {
        displayedImage.src = "default_image.jpg";
    };

    function loadImage() {
        const file = imageInput.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                // Yeni resmi önizleme için geçici bir görüntü olarak kullan
                displayedImage.src = e.target.result;

                // Yüklenen resmin boyutlarını kontrol et
                displayedImage.onload = function () {
                    const width = displayedImage.width;
                    const height = displayedImage.height;

                    // Boyutları kontrol et ve gerekirse düzenle
                    if ((width != 300) || (height != 300)) {
                        displayedImage.style.width = "300px";
                        displayedImage.style.height = "300px";
                    } else {
                        displayedImage.style.width = width + "px";
                        displayedImage.style.height = height + "px";
                    }
                };
            };

            reader.readAsDataURL(file);
        }
    }

    function findCharacters() {
        if (displayedImage.getAttribute('src') === "default_image.jpg") {
            alert("Please select or load an image first.");
        } else {
            const file = imageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = function () {
                    const base64Image = reader.result.split(',')[1];

                    // Call the Roboflow API
                    const apiUrl = "https://detect.roboflow.com/e7_character_combat/1";
                    const apiKey = "AGVpfz4xEx87AziG2odL";

                    fetch(`${apiUrl}?api_key=${apiKey}&format=image_and_json`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: base64Image,
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Display JSON results in the resultDiv
                        resultDiv.innerHTML = `
                            <h2>Inference Results</h2>
                            <pre>${JSON.stringify(data.predictions, null, 2)}</pre>
                        `;

                        // Display the result image if available
                        if (data.image) {
                            resultImage.src = 'data:image/jpeg;base64,' + data.image;
                            resultImage.style.display = 'block';  // Ensure the image is displayed
                        } else {
                            resultImage.style.display = 'none';  // Hide the image if not available
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                };

                reader.readAsDataURL(file);
            }
        }
    }
</script>

</body>
</html>
